

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial &mdash; CaLES  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="Examples.html" />
    <link rel="prev" title="Introduction" href="Introduction.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            CaLES
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#compile">Compile</a></li>
<li class="toctree-l2"><a class="reference internal" href="#input">Input</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-input-nml">Setting <cite>input.nml</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="#namelist-dns">Namelist <cite>&amp;dns</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="#namelist-les">Namelist <cite>&amp;les</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="#namelist-cudecomp">Namelist <cite>&amp;cudecomp</cite></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#visualization">Visualization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#d-fields">3D fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">2D fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="#checkpoint-files">Checkpoint files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="Bibliography.html">Bibliography</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CaLES</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Link to this heading"></a></h1>
<section id="compile">
<span id="compile-section"></span><h2>Compile<a class="headerlink" href="#compile" title="Link to this heading"></a></h2>
<p>For most systems, CaLES can be compiled from the root directory with the following commands <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">libs</span> <span class="pre">&amp;&amp;</span> <span class="pre">make</span></code>, which will compile the 2DECOMP&amp;FFT/cuDecomp libraries and CaLES. <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code> clears the CaLES build files, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">libsclean</span></code> clears the 2DECOMP/cuDecomp builds, and <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">allclean</span></code> clears both.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> in root directory is used to compiled the code, and is expected to work out-of-the-box for most systems. The <code class="docutils literal notranslate"><span class="pre">build.conf</span></code> file in the root directory can be used to choose the Fortran compiler (MPI wrapper), a few pre-defined profiles depending on the nature of the run (e.g., production vs debugging), and pre-processing options:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># compiler and compiling profile
#
FCOMP=GNU           # options: GNU, NVIDIA, INTEL
FFLAGS_OPT=1        # for production runs
FFLAGS_OPT_MAX=0    # for production runs (more aggressive optimization)
FFLAGS_DEBUG=0      # for debugging
FFLAGS_DEBUG_MAX=0  # for thorough debugging
#
# defines
#
DEBUG=1                    # best = 1 (no significant performance penalty)
TIMING=1                   # best = 1
IMPDIFF=0                  #
IMPDIFF_1D=0               #
PENCIL_AXIS=1              # = 1/2/3 for X/Y/Z-aligned pencils
SINGLE_PRECISION=0         # perform the whole calculation in single precision
#
# GPU-related
#
GPU=0
USE_NVTX=0
</pre></div>
</div>
<p>In this file, <code class="docutils literal notranslate"><span class="pre">FCOMP</span></code> can be one of <strong>GNU</strong> (<strong>gfortran</strong>), <strong>INTEL</strong> (<strong>ifort</strong>), <strong>NVIDIA</strong> (<strong>nvfortran</strong>), or <strong>CRAY</strong> (<strong>ftn</strong>); the predefined profiles for compiler options can be selected by choosing one of the <code class="docutils literal notranslate"><span class="pre">FFLAGS_*</span></code> option; finer control of the compiler flags may be achieved by building with, e.g., <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">FFLAGS+=[OTHER_FLAGS]</span></code>, or by tweaking the profiles directly under <code class="docutils literal notranslate"><span class="pre">configs/flags.mk</span></code>. Similarly, the library paths (e.g., for FFTW) may need to be adapted in the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> (<code class="docutils literal notranslate"><span class="pre">LIBS</span></code> variable) or by building with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">LIBS+='-L[PATH_TO_LIB]</span> <span class="pre">-l[NAME_OF_LIB]'</span></code>. Finally, the following pre-processing options are available:</p>
<ul class="simple">
<li><p><strong>DEBUG</strong>                    : performs some basic checks for debugging purposes</p></li>
<li><p><strong>TIMING</strong>                   : wall-clock time per time step is computed</p></li>
<li><p><strong>IMPDIFF</strong>                  : diffusion term of the N-S equations is integrated in time with an implicit discretization (thereby improving the stability of the numerical algorithm for viscous-dominated flows)</p></li>
<li><p><strong>IMPDIFF_1D</strong>               : same as above, but with implicit diffusion <strong>only</strong> along Z; for optimal parallel performance this option should be combined with <code class="docutils literal notranslate"><span class="pre">PENCIL_AXIS=3</span></code></p></li>
<li><p><strong>PENCIL_AXIS</strong>              : sets the default pencil direction, one of [1,2,3] for [X,Y,Z]-aligned pencils; X-aligned is the default and should be optimal for all cases except for Z implicit diffusion, where using Z-pencils is recommended</p></li>
<li><p><strong>SINGLE_PRECISION</strong>         : calculation will be carried out in single precision (the default precision is double)</p></li>
<li><p><strong>GPU</strong>                      : enable GPU accelerated runs (requires the <code class="docutils literal notranslate"><span class="pre">FCOMP=NVIDIA</span></code>)</p></li>
<li><p><strong>USE_NVTX</strong>                 : enable <a class="reference external" href="https://https://docs.nvidia.com/nsight-visual-studio-edition/nvtx">NVTX</a> markers to tag certain code regions and assist with profiling</p></li>
</ul>
<p>Typing <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">libs</span></code> will build the 2DECOMP&amp;FFT/cuDecomp libraries; then typing <code class="docutils literal notranslate"><span class="pre">make</span></code> will compile the code and create the executable <code class="docutils literal notranslate"><span class="pre">cales</span></code> in <code class="docutils literal notranslate"><span class="pre">build/</span></code>.</p>
<p>Note that cuDecomp needs to be dynamically linked before performing a GPU run. To do this, one should update the <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> environment variable as follows (from the root directory):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>export LD_LIBRARY_PATH=$PWD/dependencies/cuDecomp/build/lib:$LD_LIBRARY_PATH
</pre></div>
</div>
<p>Finally, the choice of compiler <code class="docutils literal notranslate"><span class="pre">FCOMP</span></code> (see <code class="docutils literal notranslate"><span class="pre">configs/flags.mk</span></code>), and profile flags <code class="docutils literal notranslate"><span class="pre">FFLAGS_*</span></code> (see <code class="docutils literal notranslate"><span class="pre">configs/flags.mk</span></code>) can easily be overloaded, for instance, as: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">FC=ftn</span> <span class="pre">FFLAGS=-O2</span></code>. Linking and Include options can be changed in <code class="docutils literal notranslate"><span class="pre">configs/libs.mk</span></code>.</p>
</section>
<section id="input">
<span id="input-section"></span><h2>Input<a class="headerlink" href="#input" title="Link to this heading"></a></h2>
<section id="setting-input-nml">
<h3>Setting <cite>input.nml</cite><a class="headerlink" href="#setting-input-nml" title="Link to this heading"></a></h3>
<p>Consider the following input file  as an example of wall-modeled LES (WMLES) of a turbulent plane channel flow. The <code class="docutils literal notranslate"><span class="pre">&amp;dns</span></code> namelist contains the necessary physical and computational parameters to set a case. The <code class="docutils literal notranslate"><span class="pre">&amp;les</span></code> namelist includes parameters for the large-eddy simulation model. The <code class="docutils literal notranslate"><span class="pre">&amp;cudecomp</span></code> namelist is optional and sets some runtime configurations for the cuDecomp library.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&amp;dns
ng(1:3) = 128, 96, 64
l(1:3) = 12.8, 4.8, 2.
gtype = 6, gr = 0.
cfl = 0.95, dtmin = 1.e5
visci = 125000.
inivel = &#39;poi&#39;
is_wallturb = T
nstep = 100000, time_max = 100., tw_max = 0.1
stop_type(1:3) = T, F, F
restart = F, is_overwrite_save = T, nsaves_max = 0
icheck = 10, iout0d = 10, iout1d = 100, iout2d = 500, iout3d = 10000, isave = 5000
cbcvel(0:1,1:3,1) = &#39;P&#39;,&#39;P&#39;,  &#39;P&#39;,&#39;P&#39;,  &#39;D&#39;,&#39;D&#39;
cbcvel(0:1,1:3,2) = &#39;P&#39;,&#39;P&#39;,  &#39;P&#39;,&#39;P&#39;,  &#39;D&#39;,&#39;D&#39;
cbcvel(0:1,1:3,3) = &#39;P&#39;,&#39;P&#39;,  &#39;P&#39;,&#39;P&#39;,  &#39;D&#39;,&#39;D&#39;
cbcpre(0:1,1:3)   = &#39;P&#39;,&#39;P&#39;,  &#39;P&#39;,&#39;P&#39;,  &#39;N&#39;,&#39;N&#39;
cbcsgs(0:1,1:3)   = &#39;P&#39;,&#39;P&#39;,  &#39;P&#39;,&#39;P&#39;,  &#39;D&#39;,&#39;D&#39;
bcvel(0:1,1:3,1) =  0.,0.,   0.,0.,   0.,0.
bcvel(0:1,1:3,2) =  0.,0.,   0.,0.,   0.,0.
bcvel(0:1,1:3,3) =  0.,0.,   0.,0.,   0.,0.
bcpre(0:1,1:3  ) =  0.,0.,   0.,0.,   0.,0.
bcsgs(0:1,1:3)   =  0.,0.,   0.,0.,   0.,0.
bforce(1:3) = 0., 0., 0.
is_forced(1:3) = T, F, F
velf(1:3) = 1., 0., 0.
dims(1:2) = 2, 2

&amp;les
sgstype = &#39;smag&#39;
lwm(0:1,1:3) = 0,0, 0,0, 1,1
hwm = 0.1

&amp;cudecomp
cudecomp_t_comm_backend = 0, cudecomp_is_t_enable_nccl = T, cudecomp_is_t_enable_nvshmem = T
cudecomp_h_comm_backend = 0, cudecomp_is_h_enable_nccl = T, cudecomp_is_h_enable_nvshmem = T
</pre></div>
</div>
<p>Here is a tip for vim/nvim users. Consider adding the following lines in your <code class="docutils literal notranslate"><span class="pre">.vimrc</span></code> file for syntax highlighting of the namelist file:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># vim
if has(&quot;autocmd&quot;)
    au BufNewFile,BufRead *.nml set filetype=fortran
    au BufNewFile,BufRead *.namelist set filetype=fortran
endif
</pre></div>
</div>
</section>
<section id="namelist-dns">
<h3>Namelist <cite>&amp;dns</cite><a class="headerlink" href="#namelist-dns" title="Link to this heading"></a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ng(1:3) = 128, 96, 64
l(1:3) = 12.8, 4.8, 2.
gtype = 6, gr = 0.
</pre></div>
</div>
<p>These lines set the computational grid.</p>
<p><code class="docutils literal notranslate"><span class="pre">ng(1:3)</span></code> and <code class="docutils literal notranslate"><span class="pre">l(1:3)</span></code> are the <strong>number of points</strong>  and <strong>domain length</strong> in each direction.</p>
<p><code class="docutils literal notranslate"><span class="pre">gtype</span></code> and <code class="docutils literal notranslate"><span class="pre">gr</span></code> are the <strong>grid stretching type</strong> and <strong>grid stretching parameter</strong> that tweak the non-uniform grid in the third direction; zero <code class="docutils literal notranslate"><span class="pre">gr</span></code> implies no stretching. See <code class="docutils literal notranslate"><span class="pre">initgrid.f90</span></code> for more details. The following options are available for <code class="docutils literal notranslate"><span class="pre">gtype</span></code>:</p>
<ul class="simple">
<li><p>1: grid clustered towards both ends (default)</p></li>
<li><p>2: grid clustered towards the lower end</p></li>
<li><p>3: grid clustered towards the upper end</p></li>
<li><p>4: grid clustered towards the middle</p></li>
<li><p>5: grid clustered towards both ends naturally</p></li>
<li><p>6: grid clustered towards both ends suitable for WMLES of wall-bounded flows</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cfl = 0.95, dtmin = 1.e5
</pre></div>
</div>
<p>This line controls the simulation time step.</p>
<p>The time step is set to be equal to <code class="docutils literal notranslate"><span class="pre">min(cfl*dtmax,dtmin)</span></code>, i.e. the minimum value between <code class="docutils literal notranslate"><span class="pre">dtmin</span></code> and <code class="docutils literal notranslate"><span class="pre">cfl</span></code> times the maximum allowable time step <code class="docutils literal notranslate"><span class="pre">dtmax</span></code> (computed every <code class="docutils literal notranslate"><span class="pre">ickeck</span></code> time steps; see below).
<code class="docutils literal notranslate"><span class="pre">dtmin</span></code> is therefore used when a constant time step, smaller than <code class="docutils literal notranslate"><span class="pre">cfl*dtmax</span></code>, is required. If not, it should be set to a high value so that the time step is dynamically adjusted to <code class="docutils literal notranslate"><span class="pre">cfl*dtmax</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>visci = 125000.
</pre></div>
</div>
<p>This line defines the inverse of the fluid viscosity, <code class="docutils literal notranslate"><span class="pre">visci</span></code>, meaning that the viscosity is <code class="docutils literal notranslate"><span class="pre">visc</span> <span class="pre">=</span> <span class="pre">visci**(-1)</span></code>. For a setup defined with two unit reference lengths and velocity scales, <code class="docutils literal notranslate"><span class="pre">visci</span></code> is half of the flow Reynolds number, as in the given example. For a setup defined with unit reference length and velocity scales, <code class="docutils literal notranslate"><span class="pre">visci</span></code> has the same value as the flow Reynolds number.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>inivel = &#39;poi&#39;
is_wallturb = T
</pre></div>
</div>
<p>These lines set the initial velocity field.</p>
<p><code class="docutils literal notranslate"><span class="pre">inivel</span></code> <strong>chooses the initial velocity field</strong>. The following options are available:</p>
<ul class="simple">
<li><p><cite>zer</cite>: zero velocity field</p></li>
<li><p><cite>uni</cite>: uniform velocity field equal to <cite>uref</cite>                                     ; streamwise direction in <cite>x</cite></p></li>
<li><p><cite>cou</cite>: plane Couette flow profile with symmetric wall velocities equal to <cite>uref/2</cite>; streamwise direction in <cite>x</cite></p></li>
<li><p><cite>poi</cite>: plane Poiseuille flow profile with mean velocity <cite>uref</cite>                    ; streamwise direction in <cite>x</cite></p></li>
<li><p><cite>tbl</cite>: temporal boundary layer profile with wall velocity <cite>uref</cite>                  ; streamwise direction in <cite>x</cite></p></li>
<li><p><cite>pdc</cite>: plane Poiseuille flow profile with constant pressure gradient              ; streamwise direction in <cite>x</cite></p></li>
<li><p><cite>log</cite>: logarithmic profile with mean velocity <cite>uref</cite>                              ; streamwise direction in <cite>x</cite></p></li>
<li><p><cite>hcp</cite>: half channel with plane Poiseuille profile and mean velocity <cite>uref</cite>        ; streamwise direction in <cite>x</cite></p></li>
<li><p><cite>hcl</cite>: half channel with logarithmic profile and mean velocity <cite>uref</cite>             ; streamwise direction in <cite>x</cite></p></li>
<li><p><cite>hdc</cite>: half plane Poiseuille flow profile with constant pressure gradient         ; streamwise direction in <cite>x</cite></p></li>
<li><p><cite>tgv</cite>: three-dimensional Taylor-Green vortex</p></li>
<li><p><cite>tgw</cite>: two-dimensional   Taylor-Green vortex</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">is_wallturb</span></code>, if true, <strong>superimposes a high amplitude disturbance on the initial velocity field</strong> that effectively triggers transition to turbulence in a wall-bounded shear flow.</p>
<p>See <code class="docutils literal notranslate"><span class="pre">initflow.f90</span></code> for more details.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>nstep = 100000, time_max = 100., tw_max = 0.1
stop_type(1:3) = T, F, F
restart = F, is_overwrite_save = T, nsaves_max = 0
</pre></div>
</div>
<p>These lines set the simulation termination criteria and whether the simulation should be restarted from a checkpoint file.</p>
<p><code class="docutils literal notranslate"><span class="pre">nstep</span></code> is the <strong>total number of time steps</strong>.</p>
<p><code class="docutils literal notranslate"><span class="pre">time_max</span></code> is the <strong>maximum physical time</strong>.</p>
<p><code class="docutils literal notranslate"><span class="pre">tw_max</span></code> is the <strong>maximum total simulation wall-clock time</strong>.</p>
<p><code class="docutils literal notranslate"><span class="pre">stop_type</span></code> sets which criteria for terminating the simulation are to be used (more than one can be selected, and at least one of them must be <cite>T</cite>)</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">stop_type(1)</span></code>, if true (<cite>T</cite>), the simulation will terminate after <code class="docutils literal notranslate"><span class="pre">nstep</span></code> time steps have been simulated</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop_type(2)</span></code>, if true (<cite>T</cite>), the simulation will terminate after <code class="docutils literal notranslate"><span class="pre">time_max</span></code> physical time units have been reached</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop_type(3)</span></code>, if true (<cite>T</cite>), the simulation will terminate after <code class="docutils literal notranslate"><span class="pre">tw_max</span></code> simulation wall-clock time (in hours) has been reached</p></li>
</ul>
<p>a checkpoint file <code class="docutils literal notranslate"><span class="pre">fld.bin</span></code> will be saved before the simulation is terminated.</p>
<p><code class="docutils literal notranslate"><span class="pre">restart</span></code>, if true, <strong>restarts the simulation</strong> from a previously saved checkpoint file, named <code class="docutils literal notranslate"><span class="pre">fld.bin</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">is_overwrite_save</span></code>, if true, overwrites the checkpoint file <code class="docutils literal notranslate"><span class="pre">fld.bin</span></code> at every save; if false, a symbolic link is created which makes <code class="docutils literal notranslate"><span class="pre">fld.bin</span></code> point to the last checkpoint file with name <code class="docutils literal notranslate"><span class="pre">fld_???????.bin</span></code> (with <code class="docutils literal notranslate"><span class="pre">???????</span></code> denoting the corresponding time step number). In the latter case, to restart a run from a different checkpoint one just has to point the file <code class="docutils literal notranslate"><span class="pre">fld.bin</span></code> to the right file, e.g.: ` ln -sf fld_0000100.bin fld.bin`.</p>
<p><code class="docutils literal notranslate"><span class="pre">nsaves_max</span></code> limits the number of saved checkpoint files, if <code class="docutils literal notranslate"><span class="pre">is_over_write_save</span></code> is false; a value of <cite>0</cite> or any negative integer corresponds to no limit, and the code uses the file format described above; otherwise, only <code class="docutils literal notranslate"><span class="pre">nsaves_max</span></code> checkpoint files are saved, with the oldest save being overwritten when the number of saved checkpoints exceeds this threshold; in this case, files with a format <code class="docutils literal notranslate"><span class="pre">fld_????.bin</span></code> are saved (with <code class="docutils literal notranslate"><span class="pre">????</span></code> denoting the saved file number), with <code class="docutils literal notranslate"><span class="pre">fld.bin</span></code> pointing to the last checkpoint file as described above; moreover, a file <code class="docutils literal notranslate"><span class="pre">log_checkpoints.out</span></code> records information about the time step number and physical time corresponding to each saved file number.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>icheck = 10, iout0d = 10, iout1d = 100, iout2d = 500, iout3d = 10000, isave = 5000
</pre></div>
</div>
<p>These lines set the frequency of time step checking and output:</p>
<ul class="simple">
<li><p>every <code class="docutils literal notranslate"><span class="pre">icheck</span></code> time steps <strong>the new time step size</strong> is computed according to the new stability criterion and cfl (above)</p></li>
<li><p>every <code class="docutils literal notranslate"><span class="pre">iout0d</span></code> time steps <strong>history files with global scalar variables</strong> are appended; currently the forcing pressure gradient and time step history are reported</p></li>
<li><p>every <code class="docutils literal notranslate"><span class="pre">iout1d</span></code> time steps <strong>1d profiles</strong> are written (e.g. velocity and its moments) to a file</p></li>
<li><p>every <code class="docutils literal notranslate"><span class="pre">iout2d</span></code> time steps <strong>2d slices of a 3d scalar field</strong> are written to a file</p></li>
<li><p>every <code class="docutils literal notranslate"><span class="pre">iout3d</span></code> time steps <strong>3d scalar fields</strong> are written to a file</p></li>
<li><p>every <code class="docutils literal notranslate"><span class="pre">isave</span></code>  time steps a <strong>checkpoint file</strong> is written (<code class="docutils literal notranslate"><span class="pre">fld_???????.bin</span></code>), and a symbolic link for the restart file, <code class="docutils literal notranslate"><span class="pre">fld.bin</span></code>, will point to this last save so that, by default, the last saved checkpoint file is used to restart the simulation</p></li>
</ul>
<p>1d, 2d and 3d outputs can be tweaked modifying files <code class="docutils literal notranslate"><span class="pre">out?d.h90</span></code>, and re-compiling the source. See also <code class="docutils literal notranslate"><span class="pre">output.f90</span></code> for more details.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cbcvel(0:1,1:3,1) = &#39;P&#39;,&#39;P&#39;,  &#39;P&#39;,&#39;P&#39;,  &#39;D&#39;,&#39;D&#39;
cbcvel(0:1,1:3,2) = &#39;P&#39;,&#39;P&#39;,  &#39;P&#39;,&#39;P&#39;,  &#39;D&#39;,&#39;D&#39;
cbcvel(0:1,1:3,3) = &#39;P&#39;,&#39;P&#39;,  &#39;P&#39;,&#39;P&#39;,  &#39;D&#39;,&#39;D&#39;
cbcpre(0:1,1:3)   = &#39;P&#39;,&#39;P&#39;,  &#39;P&#39;,&#39;P&#39;,  &#39;N&#39;,&#39;N&#39;
cbcsgs(0:1,1:3)   = &#39;P&#39;,&#39;P&#39;,  &#39;P&#39;,&#39;P&#39;,  &#39;D&#39;,&#39;D&#39;
bcvel(0:1,1:3,1) =  0.,0.,   0.,0.,   0.,0.
bcvel(0:1,1:3,2) =  0.,0.,   0.,0.,   0.,0.
bcvel(0:1,1:3,3) =  0.,0.,   0.,0.,   0.,0.
bcpre(0:1,1:3  ) =  0.,0.,   0.,0.,   0.,0.
bcsgs(0:1,1:3)   =  0.,0.,   0.,0.,   0.,0.
</pre></div>
</div>
<p>These lines set the boundary conditions (BC).</p>
<p>The <strong>type</strong> (BC) for each field variable are set by a row of six characters, <cite>X0 X1  Y0 Y1  Z0 Z1</cite> where,</p>
<ul class="simple">
<li><p><cite>X0</cite> <cite>X1</cite> set the type of BC the field variable for the <strong>lower</strong> and <strong>upper</strong> boundaries in <cite>x</cite></p></li>
<li><p><cite>Y0</cite> <cite>Y1</cite> set the type of BC the field variable for the <strong>lower</strong> and <strong>upper</strong> boundaries in <cite>y</cite></p></li>
<li><p><cite>Z0</cite> <cite>Z1</cite> set the type of BC the field variable for the <strong>lower</strong> and <strong>upper</strong> boundaries in <cite>z</cite></p></li>
</ul>
<p>The first five rows correspond to the three velocity components, pressure and eddy viscosoty, i.e. <cite>u</cite>, <cite>v</cite>, <cite>w</cite>, <cite>p</cite> and <cite>visct</cite>. The following options are available:</p>
<ul class="simple">
<li><p><cite>P</cite> periodic</p></li>
<li><p><cite>D</cite> Dirichlet</p></li>
<li><p><cite>N</cite> Neumann</p></li>
</ul>
<p>The next five rows follow the same logic but specify the boundary condition <strong>values</strong> (dummy for a periodic direction). When a wall model is applied to a wall, the boundary condition for that wall should be set to a no-slip condition as given in the example.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bforce(1:3) = 0., 0., 0.
is_forced(1:3) = T, F, F
velf(1:3) = 1., 0., 0.
</pre></div>
</div>
<p>These lines set the flow forcing.</p>
<p><code class="docutils literal notranslate"><span class="pre">bforce</span></code>, is a constant <strong>body force density term</strong> in the direction in question (e.g., the negative of a constant pressure gradient) that can be added to the right-hand-side of the momentum equation. The three values correspond to three domain directions.</p>
<p><code class="docutils literal notranslate"><span class="pre">is_forced</span></code>, if true in the direction in question, <strong>forces the flow</strong> with a pressure gradient that balances the total wall shear (e.g., for a pressure-driven channel). The three boolean values correspond to three domain directions.</p>
<p><code class="docutils literal notranslate"><span class="pre">velf</span></code>, is the <strong>target bulk velocity</strong> in the direction in question (where <code class="docutils literal notranslate"><span class="pre">is_forced</span></code> is true). The three values correspond to three domain directions.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>dims(1:2) = 2, 2
</pre></div>
</div>
<p>This line set the grid of computational subdomains.</p>
<p><code class="docutils literal notranslate"><span class="pre">dims</span></code> is the <strong>processor grid</strong>, the number of domain partitions along the first and second decomposed directions (which depend on the selected default pencil orientation). <code class="docutils literal notranslate"><span class="pre">dims(1)*dims(2)</span></code> corresponds therefore to the total number of computational subdomains. Setting <code class="docutils literal notranslate"><span class="pre">dims(:)</span> <span class="pre">=</span> <span class="pre">[0,0]</span></code> will trigger a runtime autotuning step to find the processor grid that minimizes transpose times. Note, however, that other components of the algorithm (e.g., collective I/O) may also be affected by the choice of processor grid.</p>
</section>
<section id="namelist-les">
<h3>Namelist <cite>&amp;les</cite><a class="headerlink" href="#namelist-les" title="Link to this heading"></a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sgstype = &#39;smag&#39;
lwm(0:1,1:3) = 0,0, 0,0, 1,1
hwm = 0.1
</pre></div>
</div>
<p>These lines set the subgrid-scale (SGS) model and wall model for the large-eddy simulation.</p>
<p><code class="docutils literal notranslate"><span class="pre">sgstype</span></code> is the type of <strong>subgrid-scale model</strong>. The following options are available:</p>
<ul class="simple">
<li><p>smag: classical Smagorinsky model with the van Driest damping function</p></li>
<li><p>dsmag: dynamic Smagorinsky model with Lilly’s modification</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">lwm(0:1,1:3)</span></code> sets the <strong>types of wall model</strong> for the LES. The first row corresponds to the lower wall, and the second row to the upper wall. The three columns correspond to the three domain directions. Different wall models can be applied to each wall and direction. The following options are available:</p>
<ul class="simple">
<li><p>0: no wall model</p></li>
<li><p>1: logarithmic law wall model</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">hwm</span></code> is the <strong>wall-modeled layer thickness</strong>.</p>
</section>
<section id="namelist-cudecomp">
<h3>Namelist <cite>&amp;cudecomp</cite><a class="headerlink" href="#namelist-cudecomp" title="Link to this heading"></a></h3>
<p>This is an <strong>optional</strong> namelist to set some runtime configurations for the <em>cuDecomp</em> library. Consider the following <code class="docutils literal notranslate"><span class="pre">&amp;cudecomp</span></code> namelist, which corresponds to the default options in case the file is not provided:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&amp;cudecomp
cudecomp_t_comm_backend = 0, cudecomp_is_t_enable_nccl = T, cudecomp_is_t_enable_nvshmem = T
cudecomp_h_comm_backend = 0, cudecomp_is_h_enable_nccl = T, cudecomp_is_h_enable_nvshmem = T
</pre></div>
</div>
<p>The first line sets the configuration for the transpose communication backend autotuning. Here <code class="docutils literal notranslate"><span class="pre">cudecomp_t_comm_backend</span></code> can be one of:</p>
<ul class="simple">
<li><p>1: CUDECOMP_TRANSPOSE_COMM_MPI_P2P</p></li>
<li><p>2: CUDECOMP_TRANSPOSE_COMM_MPI_P2P_PL</p></li>
<li><p>3: CUDECOMP_TRANSPOSE_COMM_MPI_A2A</p></li>
<li><p>4: CUDECOMP_TRANSPOSE_COMM_NCCL</p></li>
<li><p>5: CUDECOMP_TRANSPOSE_COMM_NCCL_PL</p></li>
<li><p>6: CUDECOMP_TRANSPOSE_COMM_NVSHMEM</p></li>
<li><p>7: CUDECOMP_TRANSPOSE_COMM_NVSHMEM_PL</p></li>
<li><p>any other value: enable runtime transpose backend autotuning</p></li>
</ul>
<p>The other two boolean values, enable/disable the NCCL (<code class="docutils literal notranslate"><span class="pre">cudecomp_is_t_enable_nccl</span></code>) and NVSHMEM (<code class="docutils literal notranslate"><span class="pre">cudecomp_is_t_enable_nvshmem</span></code>) options for <strong>transpose</strong> communication backend autotuning.</p>
<p>The second line is analogous to the first one, but for halo communication backend autotuning. Here <code class="docutils literal notranslate"><span class="pre">cudecomp_h_comm_backend</span></code> can be one of:</p>
<ul class="simple">
<li><p>1: CUDECOMP_HALO_COMM_MPI</p></li>
<li><p>2: CUDECOMP_HALO_COMM_MPI_BLOCKING</p></li>
<li><p>3: CUDECOMP_HALO_COMM_NCCL</p></li>
<li><p>4: CUDECOMP_HALO_COMM_NVSHMEM</p></li>
<li><p>5: CUDECOMP_HALO_COMM_NVSHMEM_BLOCKING</p></li>
<li><p>any other value: enable runtime halo backend autotuning</p></li>
</ul>
<p>The other two boolean values, enable/disable the NCCL (<code class="docutils literal notranslate"><span class="pre">cudecomp_is_h_enable_nccl</span></code>) and NVSHMEM (<code class="docutils literal notranslate"><span class="pre">cudecomp_is_h_enable_nvshmem</span></code>) options for <strong>halo</strong> communication backend autotuning.</p>
<p>Finally, it is worth recalling that passing <code class="docutils literal notranslate"><span class="pre">dims(1:2)</span> <span class="pre">=</span> <span class="pre">[0,0]</span></code> under <code class="docutils literal notranslate"><span class="pre">&amp;dns</span></code> will trigger the processor grid autotuning, so there is no need to provide that option in the <code class="docutils literal notranslate"><span class="pre">&amp;cudecomp</span></code> namelist.</p>
</section>
</section>
<section id="visualization">
<span id="visualization-section"></span><h2>Visualization<a class="headerlink" href="#visualization" title="Link to this heading"></a></h2>
<p>In addition to the binary files for visualization, CaLES now generates a log file that contains information about the saved data (see <code class="docutils literal notranslate"><span class="pre">out2d.h90</span></code> and <code class="docutils literal notranslate"><span class="pre">out3d.h90</span></code> for more details); this new approach uses that log file to generate the <code class="docutils literal notranslate"><span class="pre">Xdmf</span></code> visualization file.</p>
<p>The steps are as follows:</p>
<ol class="arabic simple">
<li><p>After the simulation has run, copy the contents of <code class="docutils literal notranslate"><span class="pre">utils/visualize_fields/gen_xdmf_easy/write_xdmf.py</span></code> to the simulation <code class="docutils literal notranslate"><span class="pre">data</span></code> folder.</p></li>
<li><p>Run the file with <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">write_xdmf.py</span></code>.</p></li>
<li><p>Load the generated Xdmf (<code class="docutils literal notranslate"><span class="pre">*.xmf</span></code>) file using paraview/visit or other visualization software.</p></li>
</ol>
<section id="d-fields">
<h3>3D fields<a class="headerlink" href="#d-fields" title="Link to this heading"></a></h3>
<p>When running the script <code class="docutils literal notranslate"><span class="pre">write_xdmf.py</span></code> we get the following prompts:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># python write_xdmf.py</span>
Name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>log<span class="w"> </span>file<span class="w"> </span>written<span class="w"> </span>by<span class="w"> </span>CaLES<span class="w"> </span><span class="o">[</span>log_visu_3d.out<span class="o">]</span>:
Name<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>appended<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>grid<span class="w"> </span>files<span class="w"> </span>to<span class="w"> </span>prevent<span class="w"> </span>overwriting<span class="w"> </span><span class="o">[]</span>:
Name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>output<span class="w"> </span>file<span class="w"> </span><span class="o">[</span>viewfld_DNS.xmf<span class="o">]</span>:
</pre></div>
</div>
<ul class="simple">
<li><p>The first value is the name of the file that logged the saved data.</p></li>
<li><p>The second is a name to append to the grid files that are generated, which should change for different log files to prevent conflicts.</p></li>
<li><p>The third is the name of the visualization file.</p></li>
</ul>
<p>by pressing &lt;kbd&gt;enter&lt;/kbd&gt; three times, the default values in the square brackets are assumed by the script; these correspond to the default steps required for visualizing 3D field data.</p>
</section>
<section id="id1">
<h3>2D fields<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>The procedure for visualizing 2D field data that is saved by CaLES in <code class="docutils literal notranslate"><span class="pre">out2d.h90</span></code> is exactly the same; it is just that the correct log file should be selected. CaLES saves by default field data in a plane of constant <cite>y=ly/2</cite>, and logs the saves to a file named <code class="docutils literal notranslate"><span class="pre">log_visu_2d_slice_1.out</span></code>. If more planes are saved, the user should make sure that one log file per plane is saved by CaLES (e.g. if another plane is saved, the log file written in <code class="docutils literal notranslate"><span class="pre">out2d.h90</span></code> could be named <code class="docutils literal notranslate"><span class="pre">log_visu_2d_slice_2.out</span></code>); see <code class="docutils literal notranslate"><span class="pre">out2d.h90</span></code> for more details. The corresponding steps to generate the Xdmf file would be, for instance:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># python write_xdmf.py</span>
Name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>log<span class="w"> </span>file<span class="w"> </span>written<span class="w"> </span>by<span class="w"> </span>CaLES<span class="w"> </span><span class="o">[</span>log_visu_3d.out<span class="o">]</span>:<span class="w"> </span>log_visu_2d_slice_1.out
Name<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>appended<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>grid<span class="w"> </span>files<span class="w"> </span>to<span class="w"> </span>prevent<span class="w"> </span>overwriting<span class="w"> </span><span class="o">[]</span>:<span class="w"> </span>2d
Name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>output<span class="w"> </span>file<span class="w"> </span><span class="o">[</span>viewfld_DNS.xmf<span class="o">]</span>:<span class="w"> </span>viewfld_DNS_2d.xmf
</pre></div>
</div>
</section>
<section id="checkpoint-files">
<h3>Checkpoint files<a class="headerlink" href="#checkpoint-files" title="Link to this heading"></a></h3>
<p>A similar script also located in <code class="docutils literal notranslate"><span class="pre">utils/visualize_fields/gen_xdmf_easy</span></code>, named <code class="docutils literal notranslate"><span class="pre">write_xdmf_restart.py</span></code>, can be used to generate metadata that allows to visualize the field data contained in all saved checkpoint files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># python write_xdmf_restart.py</span>
Name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>pattern<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>restart<span class="w"> </span>files<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>visualized<span class="w"> </span><span class="o">[</span>fld?*.bin<span class="o">]</span>:
Names<span class="w"> </span>of<span class="w"> </span>stored<span class="w"> </span>variables<span class="w"> </span><span class="o">[</span>VEX<span class="w"> </span>VEY<span class="w"> </span>VEZ<span class="w"> </span>PRE<span class="o">]</span>:
Name<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>appended<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>grid<span class="w"> </span>files<span class="w"> </span>to<span class="w"> </span>prevent<span class="w"> </span>overwriting<span class="w"> </span><span class="o">[</span>_fld<span class="o">]</span>:
Name<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>output<span class="w"> </span>file<span class="w"> </span><span class="o">[</span>viewfld_DNS_fld.xmf<span class="o">]</span>:
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Introduction.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, CaLES contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>